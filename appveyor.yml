#---------------------------------#
#      general configuration      #
#---------------------------------#

version: '{build}'

skip_commits:
  files:
    - '**/*.md'

#---------------------------------#
#    environment configuration    #
#---------------------------------#

image: Visual Studio 2017

matrix:
  fast_finish: true     # set this flag to immediately finish build once one of the jobs fails.

#---------------------------------#
#       build configuration       #
#---------------------------------#

platform:
  - x86
  - x64

configuration:
  - Debug
  - Release

before_build:
  - cmd: |-
      mkdir build
      cd build
      cmake --version
      cmake -G "Visual Studio 15 2017 Win64" -DCMAKE_INSTALL_PREFIX=./install ..

build:
  parallel: true                 # enable MSBuild parallel builds
  project: build\mDNSWindows.sln # path to Visual Studio solution or project

  # MSBuild verbosity level
  verbosity: minimal

for:
-
  branches:
    only:
      - master

  configuration: Release

  after_build:
    - cmd: |-
      cmake -P cmake_install.cmake
      cd install
      7z a mDNSWindows_%PLATFORM%.zip *

  artifacts:
    - path: build/install/mDNSWindows_x86.zip
      name: mDNSWindows 32-bit artifacts
    - path: build/install/mDNSWindows_x64.zip
      name: mDNSWindows 64-bit artifacts

  deploy:
    release: mDNSWindows $(APPVEYOR_REPO_TAG_NAME)
    description: 'Automated release of mDNSWindows for version $(APPVEYOR_REPO_TAG_NAME)'
    provider: GitHub
    auth_token:
      secure: D2tJBo+pb7fiu19yt3FYK5QSqT9bnMdlBHEIWutil33+rKjt1cP5nnB0m1XMkTsM
    artifact: /.*mDNSWindows.*\.zip/
    draft: false
    prerelease: false
    on:
      APPVEYOR_REPO_TAG: true        # deploy on tag push only
